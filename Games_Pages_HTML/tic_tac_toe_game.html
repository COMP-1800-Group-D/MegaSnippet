<!DOCTYPE html>
<html lang="en-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEGASNIPPET - Game - Tic Tac Toe</title>
    <link rel="stylesheet" href="../CSS/general_page_styling.css">
    <link rel="stylesheet" href="../CSS/general_page_header_styling.css">
    <link rel="stylesheet" href="../CSS/general_game_settings_page_styling.css">
    <style>
        #game_column {
            float: left;
            width: 45%;
        }

        #message_column {
            float: left;
            width: 55%;
            padding: 20px;
            font-size: 4vh;
        }

        #tic_tac_toe_board {
            display: grid;
            grid-template-columns: auto auto auto;
            justify-content: space-evenly;
            align-content: space-evenly;
            background-color: black;
            width: 65vh;
            height: 65vh;
            margin-left: auto;
        }

        .game_tile {
            font-family: Verdana;
            background-color: white;
            width: 20vh;
            height: 20vh;
            font-size: 17.5vh;
            text-align: center;
        }

        #play_again_button {
            color: white;
            background-color: red;
            visibility: hidden;
            font-size: 4vh;
            padding: 2vh 2vw;
        }

        #new_game_button {
            color: white;
            background-color: red;
            visibility: hidden;
            font-size: 4vh;
            padding: 2vh 2vw;
        }

        #gamePlayMain {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Page Header - Only a Navigation Bar-->
    <header class="cf">
        <h3>Mega<span>Snippet</span> - Tic Tac Toe</h3>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../leaderboard_page.html">Leaderboard</a></li>
            <li><a href="../game_repository_page.html">Games</a></li>
            <li><a href="../achievements_page.html">Achievements</a></li>
            <li><a href="../events_page.html">Events</a></li>
            <li><a href="../chat_page.html">Chat</a></li>
            <li><a href="../friends_page.html">Friends</a></li>
            <a class="disabled" href="#"><img class="profile-picture" src="../Images/profile_image_default.png" alt="Profile Image Default" /></a>
        </ul>
    </header>

    <!-- The main page for setting up the game -->
    <main id="gameSetupMain">
        <h1>Tic Tac Toe Game Setup</h1>
        <div id="gameSettingsColumn">
            <ul class="twoButtonsPerLine">
                <li><button id="xButton" onclick="setSide(0)">Play As X</button></li>
                <li><button id="oButton" onclick="setSide(1)">Play As O</button></li>
            </ul>
            <ul class="oneButtonPerLine">
                <li><button id="easyButton" onclick="setupGame(0)">Easy</button></li>
                <li><button id="mediumButton" onclick="setupGame(1)">Medium</button></li>
                <li><button id="hardButton" onclick="setupGame(2)">Hard</button></li>
            </ul>
            <button id="playButton" onclick="play_game()">Play Game</button>
        </div>
        <div id="gameExplanationColumn">
            <h2>Welcome to the Tic Tac Toe Game!</h2>
            <p>This is the game setup screen, please secelct if you would like to play as X or O and select a difficulty by clicking one of the buttons to the left and click Play Game.</p>
            <p>X plays first (Default), but you can play as O instead!</p>
            <h3>Difficulty Breakdown:</h3>
            <ul>
                <li><p>Easy: The computer will make the best decision 50% of the time! (Default)</p></li>
                <li><p>Medium: The computer will make the best decision 75% of the time!</p></li>
                <li><p>Hard: The computer will make the best decision 90% of the time!</p></li>
            </ul>
        </div>
    </main>

    <!-- The main page for playing the game -->
    <main id="gamePlayMain">
        <h1>Tic Tac Toe Game</h1>
        <div id="game_column">
            <div id="tic_tac_toe_board">
                <div class="game_tile" id="tile_0" onclick="pick_tile(0)"></div>
                <div class="game_tile" id="tile_1" onclick="pick_tile(1)"></div>
                <div class="game_tile" id="tile_2" onclick="pick_tile(2)"></div>
                <div class="game_tile" id="tile_3" onclick="pick_tile(3)"></div>
                <div class="game_tile" id="tile_4" onclick="pick_tile(4)"></div>
                <div class="game_tile" id="tile_5" onclick="pick_tile(5)"></div>
                <div class="game_tile" id="tile_6" onclick="pick_tile(6)"></div>
                <div class="game_tile" id="tile_7" onclick="pick_tile(7)"></div>
                <div class="game_tile" id="tile_8" onclick="pick_tile(8)"></div>
            </div>
        </div>
        <div id="message_column">
            <p>Welcome to the Tic Tac Toe Game. You're playing as X, so you can pick the first tile!</p>
            <p id="message"></p>
            <button id="play_again_button" onclick="play_again()">Play Again</button>
            <button id="new_game_button" onclick="new_game()">New Game</button>
        </div>
    </main>

    <!-- Add JavaScript Functionality -->
    <script src="../JavaScript/general_functionality.js"></script>
    <script src="../JavaScript/game_setup_functionality.js"></script>
    <script>
        let available_tiles = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        let user_tiles = [];
        let computer_tiles = [];
        let game_end = false;
        let gameSides = ['xButton', 'oButton']

        const gameDifficultyButtons = ["easyButton", "mediumButton", "hardButton"]
        const gameDifficultyLevels = [50, 75, 90]
        let gameDefault = true;
        let gameDifficulty;
        let playerSide = 'X';

        function setSide(sideRefIndex){
            selectAButtonFromListDeselectAllOtherButtons(sideRefIndex, gameSides)
            playerSide = gameSides[sideRefIndex][0].toUpperCase();
        }

        function setupGame(difficultyIndex){
            gameDefault = false;
            selectAButtonFromListDeselectAllOtherButtons(difficultyIndex, gameDifficultyButtons)
            gameDifficulty = gameDifficultyLevels[difficultyIndex];
        }

        function play_game(){
            if (gameDefault){
                setupGame(0);
            }
            document.getElementById("gameSetupMain").style.display = "none";
            document.getElementById("gamePlayMain").style.display = "block";
        }

        function pick_tile(tile){
            if (!game_end && was_pick_acceptable(tile)) {
                if (did_win(user_tiles)){
                    document.getElementById("message").innerHTML = 'Congradulations, you won! If you want to play again, please press the button below!';
                    game_end = true;
                    document.getElementById("play_again_button").style.visibility = "visible";
                    document.getElementById("new_game_button").style.visibility = "visible";
                }
                else if (did_tie()){
                    document.getElementById("message").innerHTML = 'Good game, it was a tie! If you want to play again, please press the button below!';
                    game_end = true;
                    document.getElementById("play_again_button").style.visibility = "visible";
                    document.getElementById("new_game_button").style.visibility = "visible";
                }
                else {
                    // Add a 400 milisecond wait before executing
                    computer_pick()
                }
                if (did_win(computer_tiles)){
                    document.getElementById("message").innerHTML = 'Unfortunately, you lost! If you want to play again, please press the button below!';
                    game_end = true;
                    document.getElementById("play_again_button").style.visibility = "visible";
                    document.getElementById("new_game_button").style.visibility = "visible";
                }
            }
        }

        function was_pick_acceptable(tile){
            if (is_in_list(tile, available_tiles)) {
                document.getElementById("message").innerHTML = '';
                let tile_ID = "tile_" + tile;
                document.getElementById(tile_ID).innerHTML = 'X';
                user_tiles.push(tile);
                remove_from_list(tile, available_tiles);
                return true;
            }
            document.getElementById("message").innerHTML = 'Pease pick an empty tile!';
            return false;
        }

        function did_win(target_tiles){
            if (is_in_list(0, target_tiles) && is_in_list(1, target_tiles) && is_in_list(2, target_tiles)){
                return true;
            }
            else if (is_in_list(3, target_tiles) && is_in_list(4, target_tiles) && is_in_list(5, target_tiles)){
                return true;
            }
            else if (is_in_list(6, target_tiles) && is_in_list(7, target_tiles) && is_in_list(8, target_tiles)){
                return true;
            }
            else if (is_in_list(0, target_tiles) && is_in_list(3, target_tiles) && is_in_list(6, target_tiles)){
                return true;
            }
            else if (is_in_list(1, target_tiles) && is_in_list(4, target_tiles) && is_in_list(7, target_tiles)){
                return true;
            }
            else if (is_in_list(2, target_tiles) && is_in_list(5, target_tiles) && is_in_list(8, target_tiles)){
                return true;
            }
            else if (is_in_list(0, target_tiles) && is_in_list(4, target_tiles) && is_in_list(8, target_tiles)){
                return true;
            }
            else if (is_in_list(2, target_tiles) && is_in_list(4, target_tiles) && is_in_list(6, target_tiles)){
                return true;
            }
            else{
                return false;
            }
        }

        function did_tie(){
            if (available_tiles.length == 0)
            {
                return true;
            }
            return false;
        }

        function computer_pick(){
            // let pick_index = Math.floor(Math.random() * available_tiles.length);
            // let pick = available_tiles[pick_index]
            let pick;
            if (Math.random() * 100 < gameDifficulty){
                pick = bestTicTacToePick(available_tiles, user_tiles, computer_tiles);
            }
            else {
                pick = available_tiles[Math.floor(Math.random() * available_tiles.length)];
            }
            let comp_tile_ID = "tile_" + pick;
            document.getElementById(comp_tile_ID).innerHTML = 'O';
            computer_tiles.push(pick);
            remove_from_list(pick, available_tiles)
        }

        function bestTicTacToePick(available, userSelected, computerSelected){
            let winningMove = canWin(available, computerSelected);
            console.log(winningMove);
            let blockingMove = canWin(available, userSelected);
            console.log(blockingMove)
            if (winningMove != -1){
                return winningMove;
            }
            else if (blockingMove != -1){
                return blockingMove;
            }
            return bestMove(available, userSelected, computerSelected);
        }

        function canWin(available, alreadySelected){
            let winningCombos = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]]
            for (let winningOptionIndex = 0; winningOptionIndex < winningCombos.length; winningOptionIndex++){
                let countInList = 0;
                let missingTile = -1;
                for (let tileInQuestionIndex = 0; tileInQuestionIndex < winningCombos[winningOptionIndex].length; tileInQuestionIndex++){
                    let tileInQuestion = winningCombos[winningOptionIndex][tileInQuestionIndex];
                    console.log(tileInQuestion)
                    if (is_in_list(tileInQuestion, alreadySelected)){
                        countInList++;
                    }
                    else if (is_in_list(tileInQuestion, available)){
                        missingTile = tileInQuestion;
                    }
                }
                if (countInList == 2 && missingTile != -1){
                    return missingTile;
                }
            }
            return -1;
        }

        function bestMove(available, userSelected, computerSelected){
            let middleTile = 4
            if (is_in_list(middleTile, available)){
                return middleTile;
            }
            else if (is_in_list(0, available)){
                return 0;
            }
            else if (is_in_list(2, available)){
                return 2;
            }
            else if (is_in_list(6, available)){
                return 6;
            }
            else if (is_in_list(8, available)){
                return 8;
            }
            return available_tiles[Math.floor(Math.random() * available_tiles.length)];
        }

        function is_in_list(num, num_list){
            for (i = 0; i < num_list.length; i++){
                if (num_list[i] == num){
                    return true;
                }
            }
            return false;
        }

        function remove_from_list (num, num_list) {
            for (i = 0; i < num_list.length; i++){
                if (num_list[i] == num){
                    num_list.splice(i, 1)
                }
            }
        }

        function play_again(){
            document.getElementById('tile_0').innerHTML = '';
            document.getElementById('tile_1').innerHTML = '';
            document.getElementById('tile_2').innerHTML = '';
            document.getElementById('tile_3').innerHTML = '';
            document.getElementById('tile_4').innerHTML = '';
            document.getElementById('tile_5').innerHTML = '';
            document.getElementById('tile_6').innerHTML = '';
            document.getElementById('tile_7').innerHTML = '';
            document.getElementById('tile_8').innerHTML = '';
            available_tiles = [0, 1, 2, 3, 4, 5, 6, 7, 8]
            user_tiles = []
            computer_tiles = []
            game_end = false;
            document.getElementById("message").innerHTML = '';
            document.getElementById("play_again_button").style.visibility = "hidden";
            document.getElementById("new_game_button").style.visibility = "hidden";
        }

        function new_game(){
            play_again();
            document.getElementById("gameSetupMain").style.display = "block";
            document.getElementById("gamePlayMain").style.display = "none";
        }


    </script>
</body>
</html>